# Attestation Service Configuration
# Copy to config.yaml and fill in your values.

# Runtime profile controls secret-source enforcement:
# - development/test: plaintext config secrets are allowed
# - production: plaintext config secrets are rejected at startup
runtime_profile: "development"

# The deployed FPC contract address on Aztec L2
fpc_address: "0x27e0f62fe6edf34f850dd7c1cc7cd638f7ec38ed3eb5ae4bd8c0c941c78e67ac"

# Aztec node PXE URL
aztec_node_url: "http://localhost:8080"

# How long (seconds) each signed quote is valid. Users must submit their tx
# before this window expires. Shorter = tighter, longer = more replay risk.
quote_validity_seconds: 300

# HTTP port the service listens on
port: 3000

# ─── Operator key ─────────────────────────────────────────────────────────────
# This Aztec account signs every quote and receives fee payments as private notes.
# It must match the `operator` stored in the deployed FPC contract.
#
# TODO: In production, replace direct key access with a KMS or HSM.
#       Prefer env var OPERATOR_SECRET_KEY; avoid plaintext keys on disk.
# Secret provider modes:
# - auto: env first, then config fallback (config fallback forbidden in production)
# - env: require OPERATOR_SECRET_KEY
# - config: require operator_secret_key (for local development only)
# - kms/hsm: require adapter wiring in code and operator_secret_ref
operator_secret_provider: "auto"
# operator_secret_ref: "kms://attestation/operator-key"
# Optional explicit operator address override.
# Set this when the operator account was deployed with non-zero salt.
# operator_address: "0x089323ce9a610e9f013b661ce80dde444b554e9f6ed9f5167adb234668f0af72"
# Optional when OPERATOR_SECRET_KEY is set.
operator_secret_key: "0x0000000000000000000000000000000000000000000000000000000000000001"

# ─── Quote endpoint auth (optional, recommended in production) ───────────────
# quote_auth_mode options:
# - disabled (default, recommended only for development/test)
# - api_key
# - trusted_header
# - api_key_or_trusted_header
# - api_key_and_trusted_header
#
# runtime_profile=production requires quote_auth_mode != disabled.
quote_auth_mode: "disabled"
# quote_auth_api_key: "replace-with-random-secret"
# quote_auth_api_key_header: "x-api-key"
# quote_auth_trusted_header_name: "x-internal-attestation"
# quote_auth_trusted_header_value: "allow"

# ─── Quote rate limiting (recommended in all environments) ───────────────────
# Fixed-window throttling is applied per identity:
# - api-key auth modes: per valid API key
# - otherwise: per remote IP
# If running behind a reverse proxy, ensure this service receives the real client IP
# before relying on IP-based limits.
quote_rate_limit_enabled: true
quote_rate_limit_max_requests: 60
quote_rate_limit_window_seconds: 60
quote_rate_limit_max_tracked_keys: 10000

# ─── Accepted asset ───────────────────────────────────────────────────────────
# The single token this FPC accepts. Must match `accepted_asset` in the
# deployed contract — the contract enforces this on every call.
accepted_asset_name: "humanUSDC"
accepted_asset_address: "0x0000000000000000000000000000000000000000000000000000000000000002"

# ─── Exchange rate ────────────────────────────────────────────────────────────
# market_rate_num / market_rate_den = base rate (accepted_asset per 1 FeeJuice)
# Example: 1 FeeJuice = 0.001 USDC -> market_rate_num=1, market_rate_den=1000
#
# fee_bips: operator margin in basis points (100 = 1%).
# The user sees only the final combined rate in their quote.
market_rate_num: 1
market_rate_den: 1000
fee_bips: 200
